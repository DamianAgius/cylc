<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Task Implementation</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,fn-in,2,next --> 
<meta name="src" content="cug-html.tex"> 
<meta name="date" content="2017-03-13 20:42:00"> 
<link rel="stylesheet" type="text/css" href="cug-html.css"> 
</head><body 
>
<!--l. 5322--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlse12.html" >next</a>] [<a 
href="cug-htmlse10.html" >prev</a>] [<a 
href="cug-htmlse10.html#tailcug-htmlse10.html" >prev-tail</a>] [<a 
href="#tailcug-htmlse11.html">tail</a>] [<a 
href="cug-html.html#cug-htmlse11.html" >up</a>] </p></div>
<!--l. 5322--><p class="noindent" > <h3 id="11" class="sectionHead"><span class="titlemark"> <a href="#11">11</a>  <a 
 id="x12-15900011"></a>Task Implementation </span></h3> <div class="sectionTOCS">
&#x00A0;<span class="subsectionToc" >11.1 <a 
href="#x12-16000011.1">Task Job Scripts</a></span>
<br />&#x00A0;<span class="subsectionToc" >11.2 <a 
href="#x12-16100011.2">Inlined Tasks</a></span>
<br />&#x00A0;<span class="subsectionToc" >11.3 <a 
href="#x12-16200011.3">Returning Proper Error Status</a></span>
<br />&#x00A0;<span class="subsectionToc" >11.4 <a 
href="#x12-16300011.4">Other Task Messages</a></span>
<br />&#x00A0;<span class="subsectionToc" >11.5 <a 
href="#x12-16400011.5">Avoid Detaching Processes</a></span>
</div>
<!--l. 5325--><p class="noindent" >Existing scripts or executables can be used as cylc tasks without any modification so long as they return standard
exit status, i.e. zero on success and non-zero for failure, and do not internally spawn detaching processes
(see&#x00A0;<a 
href="#x12-16400011.5">11.5<!--tex4ht:ref: DetachingJobs --></a>).
<!--l. 5330--><p class="noindent" >
<!--l. 5330--><p class="noindent" > <h4 id="11.1" class="subsectionHead"> <span class="titlemark"> <a href="#11.1"> 11.1</a>  <a 
 id="x12-16000011.1"></a>Task Job Scripts </span></h4>
<!--l. 5333--><p class="noindent" >When a task is ready cylc generates a <span 
class="cmti-10">task job script </span>that encapsulates the runtime settings (environment and
scripts) defined for it in the suite.rc file. The job script is submitted to run by the <span 
class="cmti-10">batch system </span>chosen for the task
(see&#x00A0;<a 
href="cug-htmlse12.html#x13-16500012">12<!--tex4ht:ref: TaskJobSubmission --></a>). A task job script also exports a set of environment variables prior to executing the task <span class="lstinline"><span 
class="pcrr7t-">script</span></span> (see
&#x00A0;<a 
href="cug-htmlse10.html#x11-12300010.4.7">10.4.7<!--tex4ht:ref: TaskExecutionEnvironment --></a>).
<!--l. 5340--><p class="noindent" >As shown in the Tutorial (<a 
href="cug-htmlse8.html#x9-440008.11">8.11<!--tex4ht:ref: RunningSuitesCLI --></a>) job scripts are saved to the suite run directory; the commands used to submit them
are printed to stdout by cylc in debug mode; and they can be printed with the <span class="lstinline"><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cat</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">log</span></span> command or new
ones generated and printed with the <span class="lstinline"><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">jobscript</span></span> command. Take a look at one to see exactly how cylc wraps
and runs your tasks.
<!--l. 5347--><p class="noindent" >
<!--l. 5347--><p class="noindent" > <h4 id="11.2" class="subsectionHead"> <span class="titlemark"> <a href="#11.2"> 11.2</a>  <a 
 id="x12-16100011.2"></a>Inlined Tasks </span></h4>
<!--l. 5349--><p class="noindent" >Tasks that can be performed by simple commands written in <span class="lstinline"><span 
class="pcrr7t-">bash</span></span> can be entirely implemented within the suite.rc
file, as the task <span 
class="cmti-10">script </span>items can be multi-line strings.
                                                                                         

                                                                                         
<!--l. 5353--><p class="noindent" >
<!--l. 5353--><p class="noindent" > <h4 id="11.3" class="subsectionHead"> <span class="titlemark"> <a href="#11.3"> 11.3</a>  <a 
 id="x12-16200011.3"></a>Returning Proper Error Status </span></h4>
<!--l. 5355--><p class="noindent" >A task job script in cylc automatically traps ERR (for errors) and EXIT (for unexpected exits). When the trap is
triggered, the task job script will send a failed message back to the suite before aborting.
<!--l. 5359--><p class="noindent" >Therefore, commands in user scripts should abort with non-zero exit status if a fatal error occurs (this is just good
coding practice anyway). To prevent a command that expects a non-zero return code from triggering a trap, you can
use a control statement such as:
<!--l. 5365-->
<div class="lstlisting" id="listing-215"><span class="label"><a 
 id="x12-162001r1"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cmp</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">FILE1</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">FILE2</span><span 
class="pcrr7t-">;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-162002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">do</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">stuff</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-162003r3"></a></span><span 
class="pcrb7t-">else</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-162004r4"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">do</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">alternate</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">stuff</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-162005r5"></a></span><span 
class="pcrb7t-">fi</span>
</div>
<!--l. 5373--><p class="noindent" >In addition, the task job script has <span class="lstinline"><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">u</span></span> and <span class="lstinline"><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">o</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">pipefail</span></span> turned on explicitly to ensure that any
variable must be defined on reference (which is very useful for picking typos) and that a command fails if any part of
a pipe fails.
<!--l. 5378--><p class="noindent" >
<!--l. 5378--><p class="noindent" > <h4 id="11.4" class="subsectionHead"> <span class="titlemark"> <a href="#11.4"> 11.4</a>  <a 
 id="x12-16300011.4"></a>Other Task Messages </span></h4>
<!--l. 5380--><p class="noindent" >General (non-output) messages can also be sent to report progress, warnings, and so on, e.g.:  <!--l. 5383-->
<div class="lstlisting" id="listing-216"><span class="label"><a 
 id="x12-163001r1"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">!/</span><span 
class="pcrro7t-">bin</span><span 
class="pcrro7t-">/</span><span 
class="pcrro7t-">bash</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163002r2"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">a</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">warning</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">message</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">(</span><span 
class="pcrro7t-">this</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">will</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">be</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">logged</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">by</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">the</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">suite</span><span 
class="pcrro7t-">):</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163003r3"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">p</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">WARNING</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">oops</span><span 
class="pcrr7t-">,</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">something</span><span 
class="pcrr7t-">'</span><span 
class="pcrr7t-">s</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">fishy</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">here</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163004r4"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">information</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">(</span><span 
class="pcrro7t-">this</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">will</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">also</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">be</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">logged</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">by</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">the</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">suite</span><span 
class="pcrro7t-">):</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163005r5"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">Hello</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">from</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">foo</span><span 
class="pcrr7t-">"</span>
</div>
<!--l. 5391--><p class="noindent" >Explanatory messages can be sent before aborting on error:  <!--l. 5393-->
<div class="lstlisting" id="listing-217"><span class="label"><a 
 id="x12-163006r1"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">!/</span><span 
class="pcrro7t-">bin</span><span 
class="pcrro7t-">/</span><span 
class="pcrro7t-">bash</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163007r2"></a></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">e</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">abort</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">on</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">error</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163008r3"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">mkdir</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163009r4"></a></span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">(</span><span 
class="pcrro7t-">use</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">inline</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">error</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">checking</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">to</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">avoid</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">triggering</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">the</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">above</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">'</span><span 
class="pcrro7t-">set</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">-</span><span 
class="pcrro7t-">e</span><span 
class="pcrro7t-">')</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163010r5"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">p</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">CRITICAL</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">Failed</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">create</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">directory</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163011r6"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">now</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">abort</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">non</span><span 
class="pcrro7t-">-</span><span 
class="pcrro7t-">zero</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">exit</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">status</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">to</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">trigger</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">the</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">task</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">failed</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163012r7"></a></span><span 
class="pcrb7t-">fi</span>
</div>
<!--l. 5402--><p class="noindent" >Or equivalently, with different syntax:  <!--l. 5404-->
<div class="lstlisting" id="listing-218"><span class="label"><a 
 id="x12-163013r1"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">!/</span><span 
class="pcrro7t-">bin</span><span 
class="pcrro7t-">/</span><span 
class="pcrro7t-">bash</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163014r2"></a></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">e</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163015r3"></a></span><span 
class="pcrr7t-">mkdir</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">||</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">inline</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">error</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">checking</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">using</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">OR</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">operator</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163016r4"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">p</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">CRITICAL</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">Failed</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">create</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">directory</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163017r5"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163018r6"></a></span><span 
class="pcrr7t-">}</span>
</div>
<!--l. 5412--><p class="noindent" >But not this:  <!--l. 5414-->
<div class="lstlisting" id="listing-219"><span class="label"><a 
 id="x12-163019r1"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">!/</span><span 
class="pcrro7t-">bin</span><span 
class="pcrro7t-">/</span><span 
class="pcrro7t-">bash</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163020r2"></a></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">e</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163021r3"></a></span><span 
class="pcrr7t-">mkdir</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">aborted</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">via</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">ERR</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">trap</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163022r4"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">?</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">0</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">]];</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">so</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">this</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">will</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">never</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">be</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">reached</span><span 
class="pcrro7t-">.</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163023r5"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">task</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">p</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">CRITICAL</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">Failed</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">create</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">directory</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">illegal</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">dir</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163024r6"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-163025r7"></a></span><span 
class="pcrb7t-">fi</span>
</div>
                                                                                         

                                                                                         
<!--l. 5424--><p class="noindent" >
<!--l. 5424--><p class="noindent" > <h4 id="11.5" class="subsectionHead"> <span class="titlemark"> <a href="#11.5"> 11.5</a>  <a 
 id="x12-16400011.5"></a>Avoid Detaching Processes </span></h4>
<!--l. 5428--><p class="noindent" >If a task script starts background sub-processes and does not wait on them, or internally submits jobs to a batch
scheduler and then exits immediately, the detached processes will not be visible to cylc and the task will
appear to finish when the top-level script finishes. You will need to modify scripts like this to make
them execute all sub-processes in the foreground (or use the shell <span class="lstinline"><span 
class="pcrr7t-">wait</span></span> command to wait on them
before exiting) and to prevent job submission commands from returning before the job completes
(e.g.&#x00A0;<span class="lstinline"><span 
class="pcrr7t-">llsubmit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">s</span></span> for Loadleveler, <span class="lstinline"><span 
class="pcrr7t-">qsub</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">sync</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">yes</span></span> for Sun Grid Engine, and <span class="lstinline"><span 
class="pcrr7t-">qsub</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">W</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">block</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">true</span></span> for
PBS).
<!--l. 5439--><p class="noindent" >If this is not possible - perhaps you don&#8217;t have control over the script or can&#8217;t work out how to fix it - one
alternative approach is to use another task to repeatedly poll for the results of the detached processes:
<!--l. 5442-->
<div class="lstlisting" id="listing-220"><span class="label"><a 
 id="x12-164001r1"></a></span><span 
class="pcrr7t-">[</span><span 
class="pcrr7t-">scheduling</span><span 
class="pcrr7t-">]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">dependencies</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164003r3"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">graph</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">checker</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">post</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">proc</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164004r4"></a></span><span 
class="pcrr7t-">[</span><span 
class="pcrr7t-">runtime</span><span 
class="pcrr7t-">]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164005r5"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164006r6"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">Uh</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">oh</span><span 
class="pcrr7t-">,</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">this</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">does</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">an</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">internal</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">submission</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">exe</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164007r7"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sh</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164008r8"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">checker</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164009r9"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">Fail</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">and</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">retry</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">every</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">minute</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">(</span><span 
class="pcrr7t-">for</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">10</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">tries</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">at</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">the</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">most</span><span 
class="pcrr7t-">)</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">the</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">'</span><span 
class="pcrr7t-">s</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164010r10"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">done</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">indicator</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">file</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">does</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">not</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">exist</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">yet</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164011r11"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">retry</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">delays</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">10</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x22C6;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">PT1M</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-164012r12"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">f</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">RUN_DIR</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">done</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&amp;&amp;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">"</span>
</div>
                                                                                         

                                                                                         
<!--l. 5457--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlse12.html" >next</a>] [<a 
href="cug-htmlse10.html" >prev</a>] [<a 
href="cug-htmlse10.html#tailcug-htmlse10.html" >prev-tail</a>] [<a 
href="cug-htmlse11.html" >front</a>] [<a 
href="cug-html.html#cug-htmlse11.html" >up</a>] </p></div>
<!--l. 5457--><p class="noindent" ><a 
 id="tailcug-htmlse11.html"></a>  
</body></html> 
